#!/usr/bin/perl -w

use strict;

use Getopt::Long;

my ($per_second, $per_minute) = (1, 0);
GetOptions('per-second' => \$per_second,
		   'per-minute' => \$per_minute,
		   );

my ($file) = @ARGV;

my @mon = qw(Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec);
my @ts = localtime(time - 60);
$ts[5] += 1900;

# Line format: Mar 19 22:41:02
my $match = sprintf("^%s %2d %02d:%02d", $mon[$ts[4]], @ts[3,2,1]);

my $count = `egrep "$match" $file | wc -l`;

my $per = $per_minute ? $count : ($count/60);
printf("%d\n", $per);
