#!/bin/bash

IP=`ifconfig eth0 | egrep -o 'inet addr:[^ ]+' |  egrep -o '[0-9.]+'`

SECS=`/usr/bin/time -f "%e" curl -s "http://$IP:8983/solr/select?fl=title%2Ccanonical%2Curl%2Chost%2Cbytes%2Cwords%2Cns%2Clang%2Cindexed%2Ccreated%2Cviews%2Cwid%2Crevcount%2Cbacklinks%2Cwikititle%2Cwikiarticles%2Cwikipages%2Cactiveusers&qf=title%5E7+html&bf=scale%28map%28views%2C10000%2C100000000%2C10000%29%2C0%2C10%29%5E20&bq=%28%2A%3A%2A+-html%3A%28Christmas+%29%29%5E20&qt=dismax&pf=html%5E0.8+title%5E2&mm=100%25&ps=100&tie=1&hl=true&hl.fl=html%2Ctitle&hl.snippets=2&hl.fragsize=150&hl.simple.pre=%3Cspan+class%3D%22searchmatch%22%3E&hl.simple.post=%3C%2Fspan%3E&f.html.hl.alternateField=html&f.html.hl.maxAlternateFieldLength=300&indent=1&fq=%28ns%3A0%29+AND+wid%3A147&timeAllowed=2500&version=1.2&wt=json&json.nl=map&q=skywalker+jedi&start=0&rows=20" -o /dev/null 2>&1`

/usr/bin/gmetric --name=search_latency --value=$SECS --type=float --units=seconds --tmax=120 --group solr

SECS=`/usr/bin/time -f "%e" curl -s "http://$IP:8983/solr/select?fl=title%2Ccanonical%2Curl%2Chost%2Cbytes%2Cwords%2Cns%2Clang%2Cindexed%2Ccreated%2Cviews%2Cwid%2Crevcount%2Cbacklinks%2Cwikititle%2Cwikiarticles%2Cwikipages%2Cactiveusers&qf=title%5E7+html&qt=dismax&pf=html%5E0.8+title%5E2&mm=100%25&ps=100&tie=1&hl=true&hl.fl=html%2Ctitle&hl.snippets=2&hl.fragsize=150&hl.simple.pre=%3Cspan+class%3D%22searchmatch%22%3E&hl.simple.post=%3C%2Fspan%3E&f.html.hl.alternateField=html&f.html.hl.maxAlternateFieldLength=300&indent=1&fq=%28ns%3A0%29+AND+wid%3A147&timeAllowed=2500&version=1.2&wt=json&json.nl=map&q=vader+sith&start=0&rows=20" -o /dev/null 2>&1`

/usr/bin/gmetric --name=search_latency_nobf --value=$SECS --type=float --units=seconds --tmax=120 --group solr